<!DOCTYPE html><html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω keys.json - adminvienkey26199</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-image: url('https://i.imgur.com/URkbXBC.png');
      background-size: cover;
      background-position: center;
      color: white;
    }
    input, button, textarea, select {
      font-size: 14px;
      margin: 6px 0;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid black;
      box-shadow: 0 0 8px lime;
    }
    input[type=text], input[type=password], select {
      width: 80%;
    }
    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
    }
    button {
      cursor: pointer;
      background-color: #50fa7b;
      color: black;
      font-weight: bold;
      border: 2px solid black;
    }
    #status { color: lime; margin-top: 10px; }
    #error { color: red; margin-top: 10px; }
    .hidden { display: none; }
    .note {
      background: rgba(0,0,0,0.6);
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid red;
      color: red;
      font-weight: bold;
      text-align: center;
    }
    #logo {
      width: 100px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="note">‚ö†Ô∏è V√î ƒê√ÇY L√ÄM M·∫∏ G√å, ƒê√âO CHO TK MK ƒê√ÇU M√Ä V√î TH√ÅCH B·ªåN NGUU CRACK TOOL TAO AHAHAHA</div>
  <img id="logo" src="https://i.imgur.com/UYiroysl.png" alt="Logo">
  
  <div id="loginBox">
    <h3>üîê ƒêƒÉng nh·∫≠p</h3>
    <input type="text" id="username" placeholder="T√†i kho·∫£n"><br>
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u"><br>
    <button onclick="checkLogin()">‚û°Ô∏è Ti·∫øp t·ª•c</button>
  </div>

  <div id="pinBox" class="hidden">
    <input type="password" id="pin2" placeholder="Nh·∫≠p m√£ PIN 2..."><br>
    <button onclick="checkPin()">‚úÖ V√†o qu·∫£n l√Ω</button>
  </div>

  <div id="mainBox" class="hidden">
    <h2>üõ†Ô∏è Qu·∫£n l√Ω keys.json</h2>
    <label>üîë Nh·∫≠p GitHub Token:</label><br>
    <input type="password" id="token" placeholder="ghp_..."><br>
    <button onclick="loadKeys()">üì• T·∫£i keys.json</button>

    <textarea id="keyList" placeholder='{"keys": []}'></textarea><br>

    <input type="text" id="newKey" placeholder="Key m·ªõi s·∫Ω t·ª± t·∫°o..." readonly>
    <button onclick="generateKey()">üîÅ T·∫°o Key 35 k√Ω t·ª±</button><br>

    <label>‚è≥ H·∫°n s·ª≠ d·ª•ng:</label><br>
    <input type="time" id="timeInput"> ho·∫∑c 
    <input type="date" id="dateInput"><br>

    <button onclick="addKey()">‚ûï Th√™m key</button>
    <button onclick="saveKeys()">üíæ L∆∞u keys.json</button>

    <p id="status"></p>
    <p id="error"></p>

    <div id="keyDisplay" style="margin-top: 20px;"></div>
  </div>

<script>
  const owner = "adminvienkey26109";
  const repo = "trinhngocvientx";
  const path = "keys.json";
  let sha = "";

  function base64Encode(str) {
    return btoa(unescape(encodeURIComponent(str)));
  }
  function base64Decode(str) {
    return decodeURIComponent(escape(atob(str)));
  }

  function checkLogin() {
    const u = document.getElementById("username").value.trim();
    const p = document.getElementById("password").value.trim();
    if (u === "v" && p === "v") {
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("pinBox").classList.remove("hidden");
    } else {
      alert("Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u!");
    }
  }

  function checkPin() {
    const pin = document.getElementById("pin2").value.trim();
    if (pin === "261tnv") {
      document.getElementById("pinBox").classList.add("hidden");
      document.getElementById("mainBox").classList.remove("hidden");
    } else {
      alert("Sai m√£ PIN 2!");
    }
  }

  function generateKey() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < 35; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    document.getElementById("newKey").value = result;
  }

  async function loadKeys() {
    const token = document.getElementById("token").value.trim();
    if (!token) return alert("Vui l√≤ng nh·∫≠p GitHub Token!");
    localStorage.setItem("github_token", token); // L∆∞u token

    const status = document.getElementById("status");
    const error = document.getElementById("error");
    error.textContent = "";
    status.textContent = "üîÑ ƒêang t·∫£i keys.json...";
    try {
      const res = await fetch(`https://api.github.com/repos/adminvienkey26109/trinhngocvientx/contents/keys.json?ref=main}`, {
        headers: { Authorization: `token ${token}` }
      });
      if (!res.ok) throw new Error(`L·ªói t·∫£i: ${res.status}`);
      const data = await res.json();
      sha = data.sha;
      const content = base64Decode(data.content);
      document.getElementById("keyList").value = content;
      status.textContent = "‚úÖ T·∫£i keys.json th√†nh c√¥ng.";
      renderKeyList(JSON.parse(content));
    } catch (e) {
      status.textContent = "";
      error.textContent = "‚ùå L·ªói: " + e.message;
    }
  }

  function addKey() {
    const newKey = document.getElementById("newKey").value.trim();
    const textarea = document.getElementById("keyList");
    const time = document.getElementById("timeInput").value;
    const date = document.getElementById("dateInput").value;
    if (!newKey) return alert("Vui l√≤ng t·∫°o key m·ªõi.");
    if (time && date) return alert("Ch·ªâ ch·ªçn 1 trong hai: Gi·ªù HO·∫∂C Ng√†y.");

    let expires = "";
    if (time) {
      const now = new Date();
      const [h, m] = time.split(":");
      now.setHours(h, m, 0, 0);
      expires = now.toISOString();
    } else if (date) {
      const d = new Date(date);
      expires = d.toISOString();
    }

    try {
      let json = JSON.parse(textarea.value);
      if (!Array.isArray(json.keys)) json.keys = [];
      if (json.keys.find(k => typeof k === 'object' && k.key === newKey)) return alert("Key ƒë√£ t·ªìn t·∫°i.");
      json.keys.push({ key: newKey, expiresAt: expires });
      textarea.value = JSON.stringify(json, null, 2);
      document.getElementById("newKey").value = "";
      renderKeyList(json);
    } catch {
      alert("N·ªôi dung keys.json kh√¥ng h·ª£p l·ªá.");
    }
  }

  async function saveKeys() {
    const token = document.getElementById("token").value.trim();
    if (!token) return alert("Vui l√≤ng nh·∫≠p GitHub Token!");
    localStorage.setItem("github_token", token); // L∆∞u l·∫°i token

    const status = document.getElementById("status");
    const error = document.getElementById("error");
    error.textContent = "";

    const content = document.getElementById("keyList").value;
    try {
      JSON.parse(content);
    } catch {
      return alert("keys.json kh√¥ng h·ª£p l·ªá.");
    }

    status.textContent = "üíæ ƒêang l∆∞u keys.json...";
    try {
      const body = {
        message: "Update keys.json via admin tool",
        content: base64Encode(content),
        sha: sha
      };
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
        method: "PUT",
        headers: {
          "Authorization": `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 ${token}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(body)
      });
      if (!res.ok) throw new Error(`L·ªói l∆∞u file: ${res.status}`);
      const data = await res.json();
      sha = data.content.sha;
      status.textContent = "‚úÖ L∆∞u th√†nh c√¥ng!";
    } catch (e) {
      status.textContent = "";
      error.textContent = "‚ùå L·ªói: " + e.message;
    }
  }

  function renderKeyList(json) {
    const container = document.getElementById("keyDisplay");
    container.innerHTML = "";
    if (!Array.isArray(json.keys)) return;
    const now = new Date();

    json.keys.forEach((item, index) => {
      const keyDiv = document.createElement("div");
      keyDiv.style.display = "flex";
      keyDiv.style.alignItems = "center";
      keyDiv.style.margin = "6px 0";
      keyDiv.style.flexWrap = "wrap";

      const keyInfo = document.createElement("div");
      keyInfo.style.flex = "1";
      keyInfo.style.padding = "4px";
      keyInfo.style.border = "1px dashed white";
      keyInfo.style.marginRight = "6px";
      keyInfo.style.wordBreak = "break-word";

      let expired = false;
      let expiryText = "";

      if (item.expiresAt) {
        const expireDate = new Date(item.expiresAt);
        expired = now > expireDate;
        expiryText = `‚è≥ HSD: ${expireDate.toLocaleString()}`;
      } else {
        expiryText = "‚ôæÔ∏è Kh√¥ng gi·ªõi h·∫°n";
      }

      keyInfo.innerHTML = `
        üîë <b>${item.key}</b><br>
        ${expiryText} ${expired ? "‚ùå <span style='color:red'>ƒê√£ h·∫øt h·∫°n</span>" : ""}
      `;

      const copyBtn = document.createElement("button");
      copyBtn.textContent = "üìã Copy";
      copyBtn.onclick = () => {
        if (expired) {
          alert("‚ùå Key n√†y ƒë√£ h·∫øt h·∫°n!");
        } else {
          navigator.clipboard.writeText(item.key);
          alert("‚úÖ ƒê√£ sao ch√©p key!");
        }
      };

      const delBtn = document.createElement("button");
      delBtn.textContent = "üóëÔ∏è Xo√°";
      delBtn.style.marginLeft = "4px";
      delBtn.onclick = () => {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën xo√° key n√†y?")) {
          json.keys.splice(index, 1);
          document.getElementById("keyList").value = JSON.stringify(json, null, 2);
          renderKeyList(json);
        }
      };

      keyDiv.appendChild(keyInfo);
      keyDiv.appendChild(copyBtn);
      keyDiv.appendChild(delBtn);

      container.appendChild(keyDiv);
    });
  }

  // üîÅ T·ª± ƒë·ªông ƒëi·ªÅn l·∫°i token ƒë√£ l∆∞u n·∫øu c√≥
  window.onload = () => {
    const savedToken = localStorage.getItem("github_token");
    if (savedToken) {
      document.getElementById("token").value = savedToken;
    }
  };
</script>
</body>
</html>
