<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω keys.json - adminvienkey26199</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 720px;
      margin: 20px auto;
      padding: 10px;
      background: url('https://i.imgur.com/your-background.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .box {
      background: rgba(0, 0, 0, 0.75);
      padding: 20px;
      border-radius: 12px;
    }
    input, button, textarea {
      font-size: 14px;
      margin: 6px 0;
    }
    input[type=text], input[type=password] {
      width: 80%;
      padding: 6px;
    }
    textarea {
      width: 100%;
      height: 250px;
      font-family: monospace;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
    #status { color: lightgreen; margin-top: 10px; }
    #error { color: red; margin-top: 10px; }
    .logo {
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="box" id="loginBox">
    <img class="logo" src="https://i.imgur.com/your-logo.png" alt="Logo"><br>
    <h2>üîê ƒêƒÉng nh·∫≠p Qu·∫£n tr·ªã</h2>
    <input type="text" id="username" placeholder="T√†i kho·∫£n"><br>
    <input type="password" id="password" placeholder="M·∫≠t kh·∫©u"><br>
    <button onclick="login()">üîì ƒêƒÉng nh·∫≠p</button>
    <p id="loginError" style="color:red;"></p>
  </div>

  <div class="box" id="mainBox" style="display:none;">
    <h2>üõ†Ô∏è Qu·∫£n l√Ω keys.json</h2>
    
    <label>üîë Nh·∫≠p GitHub Token c·ªßa b·∫°n:</label><br>
    <input type="password" id="token" placeholder="ghp_..."><br>
    <button onclick="loadKeys()">üì• T·∫£i keys.json</button>
    
    <textarea id="keyList" placeholder='{"keys": []}'></textarea><br>

    <input type="text" id="newKey" placeholder="Nh·∫≠p key m·ªõi...">
    <button onclick="generateKey()">üîÅ Random 35 k√Ω t·ª±</button>
    <button onclick="addKey()">‚ûï Th√™m key (h·∫øt h·∫°n sau 1 ng√†y)</button><br>
    
    <button onclick="saveKeys()">üíæ L∆∞u keys.json</button>

    <p id="status"></p>
    <p id="error"></p>
  </div>

  <script>
    const owner = "adminvienkey26109";
    const repo = "trinhngocvientx";
    const path = "keys.json";
    let sha = "";

    const validUsername = "aenhavt";
    const validPassword = "aenhavienkhanh208209";

    function login() {
      const user = document.getElementById("username").value.trim();
      const pass = document.getElementById("password").value.trim();
      if (user === validUsername && pass === validPassword) {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("mainBox").style.display = "block";
      } else {
        document.getElementById("loginError").textContent = "‚ùå Sai t√†i kho·∫£n ho·∫∑c m·∫≠t kh·∫©u.";
      }
    }

    function base64Encode(str) {
      return btoa(unescape(encodeURIComponent(str)));
    }

    function base64Decode(str) {
      return decodeURIComponent(escape(atob(str)));
    }

    function generateKey() {
      const charset = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
      let key = '';
      for (let i = 0; i < 35; i++) {
        key += charset.charAt(Math.floor(Math.random() * charset.length));
      }
      document.getElementById("newKey").value = key;
    }

    async function loadKeys() {
      const token = document.getElementById("token").value.trim();
      const status = document.getElementById("status");
      const error = document.getElementById("error");
      error.textContent = "";
      if (!token) return alert("Vui l√≤ng nh·∫≠p GitHub Token!");

      status.textContent = "üîÑ ƒêang t·∫£i keys.json...";
      try {
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          headers: { Authorization: `token ${token}` }
        });
        if (!res.ok) throw new Error(`L·ªói t·∫£i: ${res.status}`);
        const data = await res.json();
        sha = data.sha;
        const content = base64Decode(data.content);
        document.getElementById("keyList").value = content;
        status.textContent = "‚úÖ T·∫£i keys.json th√†nh c√¥ng.";
      } catch (e) {
        status.textContent = "";
        error.textContent = "‚ùå L·ªói: " + e.message;
      }
    }

    function addKey() {
      const newKey = document.getElementById("newKey").value.trim();
      const textarea = document.getElementById("keyList");
      if (!newKey) return alert("Vui l√≤ng nh·∫≠p key m·ªõi.");
      try {
        let json = JSON.parse(textarea.value);
        if (!Array.isArray(json.keys)) json.keys = [];

        if (json.keys.some(k => typeof k === 'object' ? k.key === newKey : k === newKey)) {
          return alert("Key ƒë√£ t·ªìn t·∫°i.");
        }

        const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(); // 1 ng√†y
        json.keys.push({ key: newKey, expiresAt });
        textarea.value = JSON.stringify(json, null, 2);
        document.getElementById("newKey").value = "";
      } catch {
        alert("N·ªôi dung keys.json kh√¥ng h·ª£p l·ªá.");
      }
    }

    async function saveKeys() {
      const token = document.getElementById("token").value.trim();
      const status = document.getElementById("status");
      const error = document.getElementById("error");
      error.textContent = "";
      if (!token) return alert("Vui l√≤ng nh·∫≠p GitHub Token!");

      const content = document.getElementById("keyList").value;
      try {
        JSON.parse(content);
      } catch {
        return alert("keys.json kh√¥ng h·ª£p l·ªá.");
      }

      status.textContent = "üíæ ƒêang l∆∞u keys.json...";
      try {
        const body = {
          message: "Update keys.json via admin tool",
          content: base64Encode(content),
          sha: sha
        };
        const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
          method: "PUT",
          headers: {
            "Authorization": `token ${token}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(body)
        });
        if (!res.ok) throw new Error(`L·ªói l∆∞u file: ${res.status}`);
        const data = await res.json();
        sha = data.content.sha;
        status.textContent = "‚úÖ L∆∞u th√†nh c√¥ng!";
      } catch (e) {
        status.textContent = "";
        error.textContent = "‚ùå L·ªói: " + e.message;
      }
    }
  </script>
</body>
</html>