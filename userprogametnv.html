<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tool Vi·ªÖn Th√¥ng - ƒêƒÉng nh·∫≠p & ch·ªçn Tool</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
      user-select: none;
    }
    body {
      margin: 0;
      background: linear-gradient(135deg, #1f1c2c, #928dab);
      color: #00ffc8;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
      text-align: center;
      font-weight: 700;
      text-shadow: 0 0 10px #00ffc8;
    }
    #app {
      max-width: 900px;
      width: 100%;
      background: #222431;
      border-radius: 16px;
      box-shadow: 0 0 30px #00ffc8;
      padding: 25px 20px 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    input[type="text"] {
      width: 100%;
      max-width: 400px;
      padding: 12px 15px;
      font-size: 1.2rem;
      border-radius: 12px;
      border: none;
      outline: none;
      background: #333a4d;
      color: #00ffc8;
      margin-bottom: 20px;
      box-shadow: inset 0 0 8px #00ffc8;
      transition: box-shadow 0.3s ease;
    }
    input[type="text"]:focus {
      box-shadow: inset 0 0 14px #00ffc8;
    }
    button {
      background: transparent;
      border: 2px solid #00ffc8;
      color: #00ffc8;
      padding: 18px 35px;
      font-size: 1.3rem;
      font-weight: 700;
      border-radius: 20px;
      cursor: pointer;
      margin: 8px;
      transition: background 0.3s ease, color 0.3s ease;
      user-select: none;
      min-width: 160px;
      text-align: center;
    }
    button:hover {
      background: #00ffc8;
      color: #222431;
    }
    #status {
      font-weight: 600;
      margin-bottom: 15px;
      min-height: 24px;
      text-align: center;
      user-select: text;
    }
    #gameMenu {
      display: none;
      flex-wrap: wrap;
      justify-content: center;
      gap: 18px;
      max-width: 900px;
      margin-top: 10px;
    }
    #gameContainer {
      display: none;
      flex-direction: column;
      align-items: stretch;
      max-width: 900px;
      width: 100%;
      margin-top: 20px;
    }
    #gameFrame {
      width: 100%;
      height: 550px;
      border: 3px solid #00ffc8;
      border-radius: 14px;
      box-shadow: 0 0 20px #00ffc8;
      background: #000;
    }
    #backBtn {
      margin-top: 10px;
      padding: 14px 20px;
      font-size: 1.1rem;
      font-weight: 700;
      color: #00ffc8;
      background: transparent;
      border: 2px solid #00ffc8;
      border-radius: 14px;
      cursor: pointer;
      align-self: flex-start;
      transition: background 0.3s ease;
      user-select: none;
      min-width: 120px;
    }
    #backBtn:hover {
      background: #00ffc8;
      color: #222431;
    }
    #ytFrameTop {
      width: 100%;
      max-width: 900px;
      height: 220px;
      border: none;
      border-radius: 14px;
      box-shadow: 0 0 15px #00ffc8;
      margin-bottom: 25px;
    }
    #popupUpdate {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222431;
      border: 2px solid #00ffc8;
      padding: 25px 35px;
      border-radius: 18px;
      box-shadow: 0 0 40px #00ffc8;
      color: #00ffc8;
      max-width: 400px;
      text-align: center;
      display: none;
      z-index: 9999;
      user-select: text;
    }
    #popupUpdate button {
      margin-top: 20px;
      width: 100%;
      font-size: 1rem;
      padding: 10px 0;
    }
    #headerButtons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    #countdownTimer {
      margin-top: 5px;
      font-weight: 700;
      font-size: 1rem;
      color: #ff5656;
      text-shadow: 0 0 8px #ff5656;
      user-select: text;
      min-height: 28px;
    }
    @media (max-width: 600px) {
      #gameFrame, #ytFrameTop {
        height: 300px;
      }
      button {
        min-width: 140px;
        font-size: 1.1rem;
        padding: 14px 25px;
      }
      #backBtn {
        min-width: 100px;
        padding: 12px 18px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <h1>üîë Tool Vi·ªÖn Th√¥ng - ƒêƒÉng nh·∫≠p & Ch·ªçn Tool</h1>

  <iframe
    id="ytFrameTop"
    src="https://www.youtube.com/embed/dQw4w9WgXcQ"
    allowfullscreen
    loading="lazy"
    title="YouTube Video"
  ></iframe>

  <div id="app">
    <input
      id="userKeyInput"
      type="text"
      placeholder="Nh·∫≠p key c·ªßa b·∫°n ·ªü ƒë√¢y..."
      autocomplete="off"
      autocorrect="off"
      autocapitalize="none"
      spellcheck="false"
    />
    <button id="btnCheckKey">üîì X√°c minh key</button>

    <div id="status"></div>
    <div id="countdownTimer"></div>

    <div id="headerButtons" style="display:none;">
      <button id="btnLogout">üö™ ƒêƒÉng xu·∫•t</button>
      <button id="btnShowNote">üìù Hi·ªán Note</button>
    </div>

    <div id="gameMenu"></div>

    <div id="gameContainer">
      <iframe id="gameFrame" src="" allowfullscreen></iframe>
      <button id="backBtn">‚¨ÖÔ∏è Quay l·∫°i</button>
    </div>
  </div>

  <div id="popupUpdate" role="dialog" aria-modal="true" aria-labelledby="popupTitle" aria-describedby="popupDesc">
    <p id="popupTitle"><strong>Th√¥ng b√°o c·∫≠p nh·∫≠t m·ªõi!</strong></p>
    <p id="popupDesc">Tool ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t phi√™n b·∫£n m·ªõi. Vui l√≤ng t·∫£i l·∫°i trang ƒë·ªÉ s·ª≠ d·ª•ng b·∫£n m·ªõi nh·∫•t.</p>
    <button id="popupCloseBtn">ƒê√≥ng</button>
  </div>

  <div id="notePopup" style="display:none; position:fixed; top:15%; left:50%; transform:translateX(-50%); background:#222431; border:2px solid #00ffc8; padding:20px 30px; border-radius:14px; box-shadow:0 0 30px #00ffc8; max-width: 400px; color:#00ffc8; z-index:10000; user-select:text;">
    <h3>üìå Ghi ch√∫</h3>
    <p>N·ªôi dung note b·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a t·∫°i ƒë√¢y.</p>
    <button id="closeNoteBtn" style="margin-top:15px; padding:10px 20px; font-weight:700; border-radius:12px; border:2px solid #00ffc8; background:transparent; color:#00ffc8; cursor:pointer;">ƒê√≥ng</button>
  </div>

  <script>
    window.addEventListener("keydown", function (e) {
      if (
        e.key === "F12" ||
        (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "J")) ||
        (e.ctrlKey && e.key === "U")
      ) {
        e.preventDefault();
      }
    });
    window.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });

    const userKeyInputEl = document.getElementById("userKeyInput");
    const btnCheckKey = document.getElementById("btnCheckKey");
    const statusEl = document.getElementById("status");
    const countdownEl = document.getElementById("countdownTimer");
    const gameMenuEl = document.getElementById("gameMenu");
    const gameContainerEl = document.getElementById("gameContainer");
    const gameFrameEl = document.getElementById("gameFrame");
    const backBtnEl = document.getElementById("backBtn");
    const popupUpdateEl = document.getElementById("popupUpdate");
    const popupCloseBtn = document.getElementById("popupCloseBtn");
    const btnLogout = document.getElementById("btnLogout");
    const btnShowNote = document.getElementById("btnShowNote");
    const headerButtons = document.getElementById("headerButtons");
    const notePopup = document.getElementById("notePopup");
    const closeNoteBtn = document.getElementById("closeNoteBtn");

    // Link tool (iframe src) - thay link th·∫≠t v√†o ƒë√¢y
    const gameLinks = [
      "lqh1.html",
      "tool1.html",
      "https://example.com/tool3",
      "https://example.com/tool4",
      "https://example.com/tool5",
      "https://example.com/tool6",
      "https://example.com/tool7",
      "https://example.com/tool8",
      "https://example.com/tool9",
      "https://example.com/tool10"
    ];

    // Link JSON ch·ª©a key h·ª£p l·ªá (ph·∫£i tr·∫£ v·ªÅ m·∫£ng key d·∫°ng ["key1", "key2", ...])
    const keyDataURL = "https://github.com/adminvienkey26109/trinhngocvientx/raw/refs/heads/main/keys.json";

    // Gi·∫£ s·ª≠ khi l∆∞u key, ta l∆∞u c·∫£ key v√† expiry (th·ªùi ƒëi·ªÉm h·∫øt h·∫°n) trong localStorage nh∆∞ JSON:
    // localStorage.setItem("userKeyData", JSON.stringify({key:"xxx", expiry: timestamp_ms}));

    function saveKeyData(key, expiryTimestamp) {
      localStorage.setItem("userKeyData", JSON.stringify({key: key, expiry: expiryTimestamp}));
    }
    function getKeyData() {
      const data = localStorage.getItem("userKeyData");
      if (!data) return null;
      try {
        return JSON.parse(data);
      } catch {
        return null;
      }
    }
    function removeKeyData() {
      localStorage.removeItem("userKeyData");
    }

    async function checkKeyOnline(key) {
      try {
        const res = await fetch(keyDataURL + "?t=" + Date.now());
        if (!res.ok) throw new Error("Kh√¥ng t·∫£i ƒë∆∞·ª£c file key.");
        const keys = await res.json();
        // Gi·∫£ s·ª≠ keys l√† m·∫£ng chu·ªói, vd: ["abcdef", "123456", ...]
        return keys.includes(key);
      } catch (e) {
        console.error(e);
        return false;
      }
    }

    function showGameMenu() {
      userKeyInputEl.style.display = "none";
      btnCheckKey.style.display = "none";
      statusEl.style.display = "none";
      countdownEl.style.display = "block";
      headerButtons.style.display = "flex";

      gameMenuEl.style.display = "flex";
      gameMenuEl.innerHTML = "";
      gameLinks.forEach((link, i) => {
        const btn = document.createElement("button");
        btn.className = "game-btn";
        btn.textContent = `‚¨¢ Tool ${i + 1}`;
        btn.style.minWidth = "180px";
        btn.style.padding = "20px 30px";
        btn.style.fontSize = "1.25rem";
        btn.style.fontWeight = "700";
        btn.style.borderRadius = "24px";
        btn.onclick = () => openTool(i);
        gameMenuEl.appendChild(btn);
      });
    }

    function openTool(index) {
      // M·ªü tool iframe
      gameMenuEl.style.display = "none";
      gameContainerEl.style.display = "flex";
      gameFrameEl.src = gameLinks[index];
      statusEl.style.display = "none";
      countdownEl.style.display = "none";
    }

    function backToMenu() {
      gameFrameEl.src = "";
      gameContainerEl.style.display = "none";
      gameMenuEl.style.display = "flex";
      countdownEl.style.display = "block";
    }

    // ƒê·∫øm ng∆∞·ª£c th·ªùi gian h·∫øt h·∫°n key
    let countdownInterval = null;
    function startCountdown(expiryTimestamp) {
      if (countdownInterval) clearInterval(countdownInterval);
      function updateCountdown() {
        const now = Date.now();
        let diff = expiryTimestamp - now;
        if (diff <= 0) {
          clearInterval(countdownInterval);
          countdownEl.textContent = "‚è≥ Key ƒë√£ h·∫øt h·∫°n! Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i.";
          removeKeyData();
          showLogin();
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        diff -= days * (1000 * 60 * 60 * 24);
        const hours = Math.floor(diff / (1000 * 60 * 60));
        diff -= hours * (1000 * 60 * 60);
        const minutes = Math.floor(diff / (1000 * 60));
        diff -= minutes * (1000 * 60);
        const seconds = Math.floor(diff / 1000);
        countdownEl.textContent = `‚è∞ Th·ªùi gian h·∫øt h·∫°n key c√≤n: ${days} ng√†y ${hours} gi·ªù ${minutes} ph√∫t ${seconds} gi√¢y`;
      }
      updateCountdown();
      countdownInterval = setInterval(updateCountdown, 1000);
    }

    function showLogin() {
      userKeyInputEl.style.display = "block";
      btnCheckKey.style.display = "inline-block";
      statusEl.style.display = "block";
      statusEl.textContent = "";
      countdownEl.style.display = "none";
      headerButtons.style.display = "none";
      gameMenuEl.style.display = "none";
      gameContainerEl.style.display = "none";
      userKeyInputEl.value = "";
    }

    btnCheckKey.addEventListener("click", async () => {
      const key = userKeyInputEl.value.trim();
      if (!key) {
        statusEl.textContent = "‚ö†Ô∏è Vui l√≤ng nh·∫≠p key.";
        return;
      }
      statusEl.textContent = "‚è≥ ƒêang ki·ªÉm tra key...";
      const valid = await checkKeyOnline(key);
      if (valid) {
        statusEl.textContent = "‚úÖ Key h·ª£p l·ªá! B·∫°n ƒë√£ ƒë∆∞·ª£c ph√©p truy c·∫≠p to√†n b·ªô Tool.";
        // Gi·∫£ s·ª≠ key c√≥ th·ªùi h·∫°n 24h t·ª´ l√∫c check th√†nh c√¥ng
        const expiry = Date.now() + 24 * 60 * 60 * 1000;
        saveKeyData(key, expiry);
        setTimeout(() => {
          showGameMenu();
          startCountdown(expiry);
        }, 1000);
      } else {
        statusEl.textContent = "‚ùå Key kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ h·∫øt h·∫°n.";
      }
    });

    btnLogout.addEventListener("click", () => {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t kh√¥ng?")) {
        removeKeyData();
        clearInterval(countdownInterval);
        showLogin();
      }
    });

    btnShowNote.addEventListener("click", () => {
      notePopup.style.display = "block";
    });

    closeNoteBtn.addEventListener("click", () => {
      notePopup.style.display = "none";
    });

    backBtnEl.addEventListener("click", backToMenu);

    window.addEventListener("load", () => {
      const keyData = getKeyData();
      if (keyData && keyData.key && keyData.expiry) {
        if (Date.now() < keyData.expiry) {
          statusEl.textContent = "üîë Key ƒë√£ ƒë∆∞·ª£c l∆∞u. B·∫°n c√≥ th·ªÉ ch·ªçn Tool.";
          showGameMenu();
          startCountdown(keyData.expiry);
        } else {
          removeKeyData();
          showLogin();
        }
      } else {
        showLogin();
      }
    });
  </script>
</body>
</html>
